-- SPL-DB-Sync Experiment: Flat Approach (Realistic Inefficiency)
-- Common anti-pattern: Using correlated subqueries instead of JOINs
-- This is how inexperienced developers often write queries
SELECT 
    C.C_NAME,
    C.C_ACCTBAL,
    (SELECT AVG(O.O_TOTALPRICE) 
     FROM {ORDERS_TABLE} O 
     WHERE O.O_CUSTKEY = C.C_CUSTKEY) as AVG_ORDER_VALUE,
    CASE 
        WHEN (SELECT AVG(O.O_TOTALPRICE) FROM {ORDERS_TABLE} O WHERE O.O_CUSTKEY = C.C_CUSTKEY) > 300000 THEN 'Platinum'
        WHEN (SELECT AVG(O.O_TOTALPRICE) FROM {ORDERS_TABLE} O WHERE O.O_CUSTKEY = C.C_CUSTKEY) > 200000 THEN 'Gold'
        WHEN (SELECT AVG(O.O_TOTALPRICE) FROM {ORDERS_TABLE} O WHERE O.O_CUSTKEY = C.C_CUSTKEY) > 100000 THEN 'Silver'
        ELSE 'Bronze'
    END AS LOYALTY_TIER
FROM {CUSTOMER_TABLE} C
WHERE (SELECT COUNT(*) FROM {ORDERS_TABLE} O WHERE O.O_CUSTKEY = C.C_CUSTKEY) > 0
AND (SELECT AVG(O.O_TOTALPRICE) FROM {ORDERS_TABLE} O WHERE O.O_CUSTKEY = C.C_CUSTKEY) > 80000
ORDER BY (SELECT AVG(O.O_TOTALPRICE) FROM {ORDERS_TABLE} O WHERE O.O_CUSTKEY = C.C_CUSTKEY) DESC;
