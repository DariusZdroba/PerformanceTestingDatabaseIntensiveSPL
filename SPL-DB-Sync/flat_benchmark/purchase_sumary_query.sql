-- SPL-DB-Sync Experiment: Flat Approach (Inefficient)
-- Poorly structured purchase summary using multiple redundant correlated subqueries
SELECT 
    C.C_NAME,
    (SELECT SUM(O2.O_TOTALPRICE) 
     FROM {ORDERS_TABLE} O2 
     WHERE O2.O_CUSTKEY = C.C_CUSTKEY) AS TOTAL_SPENT,
    (SELECT COUNT(O3.O_ORDERKEY) 
     FROM {ORDERS_TABLE} O3 
     WHERE O3.O_CUSTKEY = C.C_CUSTKEY) AS ORDER_COUNT,
    (SELECT AVG(O4.O_TOTALPRICE) 
     FROM {ORDERS_TABLE} O4 
     WHERE O4.O_CUSTKEY = C.C_CUSTKEY) AS AVG_ORDER_VALUE
FROM {CUSTOMER_TABLE} C
WHERE (SELECT COUNT(*) FROM {ORDERS_TABLE} O WHERE O.O_CUSTKEY = C.C_CUSTKEY) > 0
AND (SELECT SUM(O1.O_TOTALPRICE) 
     FROM {ORDERS_TABLE} O1 
     WHERE O1.O_CUSTKEY = C.C_CUSTKEY) > 100000
AND (SELECT MAX(O6.O_TOTALPRICE) 
     FROM {ORDERS_TABLE} O6 
     WHERE O6.O_CUSTKEY = C.C_CUSTKEY) IS NOT NULL
AND (SELECT MIN(O7.O_TOTALPRICE) 
     FROM {ORDERS_TABLE} O7 
     WHERE O7.O_CUSTKEY = C.C_CUSTKEY) > 0
ORDER BY (SELECT SUM(O5.O_TOTALPRICE) 
          FROM {ORDERS_TABLE} O5 
          WHERE O5.O_CUSTKEY = C.C_CUSTKEY) DESC
LIMIT 500;
