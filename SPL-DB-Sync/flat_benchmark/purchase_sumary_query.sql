-- SPL-DB-Sync Experiment: Flat Approach (Realistic Inefficiency)
-- Common anti-pattern: Calculating same aggregations multiple times
-- This is how developers write when they don't understand GROUP BY optimization
SELECT 
    C.C_NAME,
    (SELECT SUM(O.O_TOTALPRICE) 
     FROM {ORDERS_TABLE} O 
     WHERE O.O_CUSTKEY = C.C_CUSTKEY) AS TOTAL_SPENT,
    (SELECT COUNT(O.O_ORDERKEY) 
     FROM {ORDERS_TABLE} O 
     WHERE O.O_CUSTKEY = C.C_CUSTKEY) AS ORDER_COUNT,
    (SELECT SUM(O.O_TOTALPRICE) / COUNT(O.O_ORDERKEY) 
     FROM {ORDERS_TABLE} O 
     WHERE O.O_CUSTKEY = C.C_CUSTKEY) AS AVG_ORDER_VALUE
FROM {CUSTOMER_TABLE} C
WHERE EXISTS (SELECT 1 FROM {ORDERS_TABLE} O WHERE O.O_CUSTKEY = C.C_CUSTKEY)
AND (SELECT SUM(O.O_TOTALPRICE) FROM {ORDERS_TABLE} O WHERE O.O_CUSTKEY = C.C_CUSTKEY) > 100000
ORDER BY (SELECT SUM(O.O_TOTALPRICE) FROM {ORDERS_TABLE} O WHERE O.O_CUSTKEY = C.C_CUSTKEY) DESC
LIMIT 500;
